# `newdistance.py` 代码总结

## 1. 功能概述
该脚本主要用于图像角点检测、坐标处理及结果输出，支持常规多边形和五角星模式的角点分析，最终生成归一化坐标文件和差值坐标文件。

---

## 2. 核心模块与流程

### 2.1 参数设置与初始化
- **输入参数**：图片路径 `pic_path`（默认 `./photos/test.jpg`）、逼近系数 `param=0.02`、五角星模式开关 `star_mode`（默认关闭）。
- **输出路径**：结果保存至 `ai_gen` 文件夹（自动创建）。

### 2.2 图像采集（未启用）
- 定义 `capture_and_save` 函数，通过摄像头捕获图像并保存（当前被注释，未实际调用）。

### 2.3 图像预处理
- **旋转与灰度化**：读取图片并顺时针旋转90度，转换为灰度图。
- **模糊与二值化**：高斯模糊去噪后，使用自适应高斯二值化（`ADAPTIVE_THRESH_GAUSSIAN_C`）生成二值图。
- **形态学优化**：通过闭运算（连接边缘）和开运算（去除噪声）优化二值图质量。

### 2.4 轮廓检测与角点提取
- **轮廓筛选**：检测所有轮廓并按面积降序排序，取最大轮廓。
- **多边形逼近**：使用 `approxPolyDP` 对最大轮廓进行多边形逼近，通过 `param` 调整逼近精度（`epsilon = param * 轮廓周长`）。
- **角点排序**：找到最上方的角点作为起点，按顺时针方向排序剩余角点。

### 2.5 五角星模式支持（可选）
- 若通过命令行传入参数 `1`（如 `python newdistance.py 1`），启用五角星模式：
  - 重排角点顺序（隔一个取点，模运算）。
  - 绘制绿色五角星连线。

### 2.6 可视化与结果输出
- **角点标注**：在图像上绘制红色圆点标记角点，并使用PIL库添加中文标签（`corner1`、`corner2` 等）。
- **归一化坐标保存**：将角点坐标按比例缩放到目标画布（长边2000px），结果保存至 `ai_gen/points.txt`。
- **差值坐标计算**：计算相邻角点（含首尾闭合）的横纵坐标差值，根据正负号添加前缀（`1` 表示负，`2` 表示正），结果保存至 `ai_gen/zuobiao.txt`。

### 2.7 扩展功能（未启用）
- 注释了自动SCP上传代码（通过PowerShell或pscp工具将 `zuobiao.txt` 上传至远程服务器），需手动输入密码完成。

---

## 3. 关键输出文件
- `points.txt`：归一化后的角点坐标（按顺时针排序）。
- `zuobiao.txt`：相邻角点的差值坐标（含首尾闭合），格式为 `[符号前缀][绝对值]`（如 `1100` 表示负100，`2200` 表示正200）。

---

## 4. 注意事项
- 需确保 `ai_gen` 文件夹存在（脚本自动创建）。
- 五角星模式需通过命令行参数触发（`python newdistance.py 1`）。
- 图像预处理参数（如 `param`）需根据实际轮廓复杂度调整，否则可能检测到异常角点数（脚本会输出警告）。